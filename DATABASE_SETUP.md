# إعداد قاعدة البيانات - نظام إدارة النادي الرياضي

## 📋 معلومات الاتصال الحالية

- **Supabase URL**: https://efxciplzfivwgdyrayjm.supabase.co
- **API Key**: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmeGNpcGx6Zml2d2dkeXJheWptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxODg3ODIsImV4cCI6MjA2NTc2NDc4Mn0.xXZVhNJTPtj8lW_e-fBqgAnS5DkasLMJwh0t_8Y6l64

## 🚀 خطوات الإعداد

### 1. إنشاء الجداول في Supabase

1. اذهب إلى **Supabase Dashboard**: https://app.supabase.com
2. افتح مشروعك: `efxciplzfivwgdyrayjm`
3. اذهب إلى **SQL Editor**
4. انسخ والصق محتوى ملف `supabase-schema.sql`
5. اضغط **Run** لتنفيذ الاستعلامات

### 2. الجداول المطلوبة

#### **الجداول الأساسية:**

- `members` - بيانات الأعضاء
- `courses` - الكورسات التدريبية
- `diet_plans` - الأنظمة الغذائية
- `products` - المنتجات والمكملات
- `sales` - المبيعات
- `sync_status` - حالة المزامنة

#### **الفهارس للأداء:**

- فهارس على الأسماء والتواريخ
- فهارس للبحث والفلترة
- فهارس لتحسين أداء المزامنة

### 3. الأمان والصلاحيات

#### **الخيار الأول: بدون مصادقة (للاستخدام الداخلي)**

```sql
-- تفعيل الوصول العام للجداول
CREATE POLICY "Enable all operations for anon users" ON members FOR ALL USING (auth.role() = 'anon');
-- كرر نفس السطر لجميع الجداول
```

#### **الخيار الثاني: مع مصادقة (للاستخدام المتقدم)**

```sql
-- تفعيل الوصول للمستخدمين المسجلين فقط
CREATE POLICY "Enable all operations for authenticated users" ON members FOR ALL USING (auth.role() = 'authenticated');
-- كرر نفس السطر لجميع الجداول
```

### 4. البيانات التجريبية

الملف يتضمن بيانات تجريبية أساسية:

- 5 كورسات تدريبية
- 5 أنظمة غذائية

## 🔄 نظام المزامنة

### كيف يعمل النظام:

1. **التخزين المحلي**: جميع البيانات تحفظ في `IndexedDB` للعمل أوفلاين
2. **المزامنة التلقائية**: البيانات تتزامن مع Supabase كل 30 ثانية
3. **قائمة الانتظار**: العمليات أثناء الأوفلاين تحفظ في queue
4. **حل التعارضات**: النظام يفضل البيانات الأحدث زمنياً

### مؤشرات الحالة:

- 🟢 **أخضر**: متصل ومزامن
- 🟡 **أصفر**: جاري المزامنة
- 🟠 **برتقالي**: متصل مع عمليات غير مزامنة
- 🔴 **أحمر**: غير متصل (عمل أوفلاين)

## 🛠️ استكشاف الأخطاء

### مشاكل شائعة:

#### **خطأ: "Cannot connect to Supabase"**

- تأكد من صحة URL و API Key
- تأكد من وجود اتصال بالإنترنت
- تحقق من إعدادات CORS في Supabase

#### **خطأ: "Table does not exist"**

- تأكد من تنفيذ جميع استعلامات إنشاء الجداول
- تحقق من أسماء الجداول في SQL Editor

#### **خطأ: "Permission denied"**

- تأكد من إعداد Row Level Security policies
- تحقق من صلاحيات API Key

### فحص الاتصال:

يمكنك فحص الاتصال من خلال:

1. النظر لمؤشر الحالة في الهيدر
2. فتح Developer Console ومراقبة الرسائل
3. التحقق من تزامن البيانات الجديدة

## 📊 مراقبة النظام

### في Supabase Dashboard:

- **Database > Tables**: لمشاهدة البيانات
- **API > Logs**: لمراقبة الاستعلامات
- **Settings > API**: لإدارة المفاتيح

### في التطبيق:

- مؤشر حالة المزامنة في الهيدر
- إشعارات تلقائية للاتصال/انقطاع
- عداد العمليات غير المزامنة

## 🎯 التحقق من نجاح الإعداد

1. **افتح التطبيق**
2. **تأكد من ظهور**: مؤشر أخضر في الهيدر
3. **أضف عضو تجريبي** وتأكد من ظهوره في Supabase
4. **اقطع الإنترنت** وأضف عضو آخر
5. **أعد تشغيل الإنترنت** وتأكد من المزامنة

## 📞 الدعم

إذا واجهت أي مشاكل:

1. تحقق من الكونسول للرسائل التشخيصية
2. تأكد من تنفيذ جميع خطوات الإعداد
3. راجع إعدادات Supabase Dashboard

---

**✅ بعد اكتمال الإعداد، النظام سيعمل بكامل طاقته أوفلاين وأونلاين!**
