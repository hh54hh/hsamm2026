/*
===============================================
   ุฅุตูุงุญ ุณุฑูุน: ุฅุถุงูุฉ ุนููุฏ ุงููุฆุฉ ุงูููููุฏ
===============================================

ุงููุดููุฉ: ุงูุนููุฏ 'category' ููููุฏ ูู ุฌุฏูู products
ุงูุญู: ุฅุถุงูุฉ ุงูุนููุฏ ูุน ุงูููู ุงูุงูุชุฑุงุถูุฉ

ุชุนูููุงุช ุงูุงุณุชุฎุฏุงู:
1. ุงูุชูู ุฅูู Supabase Dashboard
2. ุงุถุบุท ุนูู "SQL Editor" 
3. ุงูุณุฎ ูุงูุตู ูุญุชูู ูุฐุง ุงูููู
4. ุงุถุบุท "Run" ุฃู Ctrl+Enter
5. ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ

===============================================
*/

-- ุฅุถุงูุฉ ุนููุฏ ุงููุฆุฉ ุฅูู ุฌุฏูู ุงูููุชุฌุงุช
DO $$
BEGIN
    -- ุงูุชุญูู ูู ูุฌูุฏ ุงูุนููุฏ ุฃููุงู
    IF NOT EXISTS (
        SELECT 1 
        FROM information_schema.columns 
        WHERE table_name = 'products' 
        AND column_name = 'category'
    ) THEN
        
        -- ุฅุถุงูุฉ ุงูุนููุฏ
        ALTER TABLE products 
        ADD COLUMN category TEXT;
        
        RAISE NOTICE 'โ ุชู ุฅุถุงูุฉ ุนููุฏ category ุจูุฌุงุญ';
        
        -- ุชุญุฏูุซ ุงูููุชุฌุงุช ุงูููุฌูุฏุฉ ุจูุฆุงุช ุงูุชุฑุงุถูุฉ
        UPDATE products 
        SET category = CASE 
            WHEN name ILIKE '%ุจุฑูุชูู%' OR name ILIKE '%ูุฑูุงุชูู%' OR name ILIKE '%ููุชุงููู%' OR name ILIKE '%ุฃุญูุงุถ%' THEN 'ููููุงุช'
            WHEN name ILIKE '%ูุดุฑูุจ%' OR name ILIKE '%ุทุงูุฉ%' THEN 'ูุดุฑูุจุงุช'
            WHEN name ILIKE '%ุดููุฑ%' OR name ILIKE '%ุญุฒุงู%' OR name ILIKE '%ููุงุฒ%' THEN 'ุฃุฏูุงุช'
            WHEN name ILIKE '%ููุดูุฉ%' THEN 'ุฅูุณุณูุงุฑุงุช'
            ELSE 'ุฃุฎุฑู'
        END
        WHERE category IS NULL;
        
        RAISE NOTICE 'โ ุชู ุชุญุฏูุซ ูุฆุงุช ุงูููุชุฌุงุช ุงูููุฌูุฏุฉ';
        
    ELSE
        RAISE NOTICE 'โ๏ธ ุนููุฏ category ููุฌูุฏ ุจุงููุนู';
    END IF;
END
$$;

-- ุฅุถุงูุฉ ููุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
CREATE INDEX IF NOT EXISTS idx_products_category ON products(category);

-- ุนุฑุถ ุงููุชูุฌุฉ
SELECT 
    '๐ ูุญุต ุฌุฏูู ุงูููุชุฌุงุช' as test_name,
    COUNT(*) as total_products,
    COUNT(category) as products_with_category,
    CASE 
        WHEN COUNT(*) = COUNT(category) THEN 'โ ุฌููุน ุงูููุชุฌุงุช ููุง ูุฆุงุช'
        ELSE 'โ๏ธ ุจุนุถ ุงูููุชุฌุงุช ุจุฏูู ูุฆุงุช'
    END as status
FROM products;

-- ุนุฑุถ ุงููุฆุงุช ุงููุชุงุญุฉ
SELECT 
    '๐ ุงููุฆุงุช ุงููุชุงุญุฉ:' as info,
    category,
    COUNT(*) as product_count
FROM products 
WHERE category IS NOT NULL
GROUP BY category
ORDER BY product_count DESC;

/*
===============================================
           ุชู ุงูุงูุชูุงุก ูู ุงูุฅุตูุงุญ!
===============================================

ุงูุขู ููููู:
1. ุฅุถุงูุฉ ููุชุฌุงุช ุฌุฏูุฏุฉ ูุน ุงููุฆุงุช
2. ุชุนุฏูู ุงูููุชุฌุงุช ุงูููุฌูุฏุฉ
3. ุงุณุชุฎุฏุงู ุตูุญุฉ ุงููุฎุฒูู ุจุฏูู ุฃุฎุทุงุก

ุงููุฆุงุช ุงููุชุงุญุฉ:
- ููููุงุช
- ูุดุฑูุจุงุช  
- ุฃุฏูุงุช
- ุฅูุณุณูุงุฑุงุช
- ุฃุฎุฑู
===============================================
*/
